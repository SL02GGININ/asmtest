<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>零食天堂 - 優質零食網購平台</title>
    
    <!-- React & React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Animation classes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        /* Loading spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Product card hover effect */
        .product-card {
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        /* Button animations */
        .btn-primary {
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: scale(1.05);
        }
        
        .btn-primary:active {
            transform: scale(0.95);
        }
        
        /* Badge pulse animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .badge-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            ::-webkit-scrollbar-track {
                background: #1a1a1a;
            }
        }
        
        /* Responsive image */
        img {
            max-width: 100%;
            height: auto;
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        
        /* Modal overlay */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* Chatbot styles */
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #5D5CDE, #4ECDC4);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }
        
        .chatbot-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .chatbot-window.open {
            opacity: 1;
            transform: translateY(0);
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, #5D5CDE, #4ECDC4);
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
        }
        
        .message.bot {
            align-self: flex-start;
            background: #f1f1f1;
            border-bottom-left-radius: 5px;
        }
        
        .message.user {
            align-self: flex-end;
            background: #5D5CDE;
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .chatbot-input {
            display: flex;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        .chatbot-input button {
            margin-left: 10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #5D5CDE;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 15px;
            border-top: 1px solid #eee;
        }
        
        .quick-reply {
            padding: 6px 12px;
            background: #f1f1f1;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-reply:hover {
            background: #e1e1e1;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #f1f1f1;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
            max-width: 80px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #888;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#FF6B6B',
                        accent: '#4ECDC4',
                        warning: '#FFE66D',
                        dark: '#2C3E50'
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif']
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useMemo, useRef } = React;
        
        // ==================== Data Service (模擬資料庫) ====================
        const DataService = {
            // 模擬 API 延遲
            delay: (ms = 500) => new Promise(resolve => setTimeout(resolve, ms)),
            
            // 產品數據
            products: [
                // 餅乾類
                { id: 1, name: '經典奶油餅乾', category: 'cookies', price: 89, image: 'https://via.placeholder.com/300x300/FFE5B4/000000?text=奶油餅乾', description: '香濃奶油，口感酥脆', stock: 50, rating: 4.5, sales: 1200 },
                { id: 2, name: '巧克力夾心餅', category: 'cookies', price: 99, image: 'https://via.placeholder.com/300x300/D2691E/FFFFFF?text=巧克力餅', description: '濃郁巧克力夾心', stock: 35, rating: 4.8, sales: 980 },
                { id: 3, name: '蔓越莓燕麥餅', category: 'cookies', price: 109, image: 'https://via.placeholder.com/300x300/CD5C5C/FFFFFF?text=燕麥餅', description: '健康養生首選', stock: 42, rating: 4.6, sales: 756 },
                { id: 4, name: '抹茶曲奇', category: 'cookies', price: 119, image: 'https://via.placeholder.com/300x300/90EE90/000000?text=抹茶曲奇', description: '日式抹茶風味', stock: 28, rating: 4.7, sales: 634 },
                
                // 洋芋片類
                { id: 5, name: '原味洋芋片', category: 'chips', price: 45, image: 'https://via.placeholder.com/300x300/FFD700/000000?text=原味洋芋片', description: '經典原味，酥脆可口', stock: 100, rating: 4.4, sales: 2100 },
                { id: 6, name: '海苔洋芋片', category: 'chips', price: 50, image: 'https://via.placeholder.com/300x300/228B22/FFFFFF?text=海苔洋芋片', description: '海苔香氣撲鼻', stock: 85, rating: 4.6, sales: 1890 },
                { id: 7, name: '烤肉洋芋片', category: 'chips', price: 50, image: 'https://via.placeholder.com/300x300/8B4513/FFFFFF?text=烤肉洋芋片', description: '炭烤風味十足', stock: 92, rating: 4.5, sales: 1650 },
                { id: 8, name: '起司洋芋片', category: 'chips', price: 55, image: 'https://via.placeholder.com/300x300/FFA500/000000?text=起司洋芋片', description: '濃郁起司味', stock: 78, rating: 4.7, sales: 1420 },
                
                // 糖果類
                { id: 9, name: '水果軟糖', category: 'candy', price: 35, image: 'https://via.placeholder.com/300x300/FF69B4/FFFFFF?text=水果軟糖', description: '多種水果口味', stock: 120, rating: 4.3, sales: 2500 },
                { id: 10, name: '牛奶糖', category: 'candy', price: 40, image: 'https://via.placeholder.com/300x300/F5DEB3/000000?text=牛奶糖', description: '香濃牛奶風味', stock: 95, rating: 4.4, sales: 1980 },
                { id: 11, name: '棉花糖', category: 'candy', price: 45, image: 'https://via.placeholder.com/300x300/FFB6C1/000000?text=棉花糖', description: '綿密鬆軟', stock: 68, rating: 4.2, sales: 1230 },
                { id: 12, name: 'QQ軟糖', category: 'candy', price: 38, image: 'https://via.placeholder.com/300x300/9370DB/FFFFFF?text=QQ軟糖', description: 'Q彈有嚼勁', stock: 110, rating: 4.5, sales: 1850 },
                
                // 巧克力類
                { id: 13, name: '黑巧克力', category: 'chocolate', price: 129, image: 'https://via.placeholder.com/300x300/654321/FFFFFF?text=黑巧克力', description: '70%可可含量', stock: 45, rating: 4.8, sales: 890 },
                { id: 14, name: '牛奶巧克力', category: 'chocolate', price: 99, image: 'https://via.placeholder.com/300x300/D2691E/FFFFFF?text=牛奶巧克力', description: '絲滑香醇', stock: 62, rating: 4.7, sales: 1340 },
                { id: 15, name: '榛果巧克力', category: 'chocolate', price: 139, image: 'https://via.placeholder.com/300x300/8B4513/FFFFFF?text=榛果巧克力', description: '濃郁榛果香', stock: 38, rating: 4.9, sales: 720 },
                { id: 16, name: '白巧克力', category: 'chocolate', price: 109, image: 'https://via.placeholder.com/300x300/FFFACD/000000?text=白巧克力', description: '香甜順滑', stock: 52, rating: 4.6, sales: 980 },
                
                // 堅果類
                { id: 17, name: '綜合堅果', category: 'nuts', price: 159, image: 'https://via.placeholder.com/300x300/CD853F/000000?text=綜合堅果', description: '營養豐富健康零食', stock: 55, rating: 4.7, sales: 1120 },
                { id: 18, name: '夏威夷豆', category: 'nuts', price: 189, image: 'https://via.placeholder.com/300x300/DEB887/000000?text=夏威夷豆', description: '香脆可口', stock: 32, rating: 4.8, sales: 670 },
                { id: 19, name: '腰果', category: 'nuts', price: 149, image: 'https://via.placeholder.com/300x300/F4A460/000000?text=腰果', description: '原味烘焙', stock: 48, rating: 4.6, sales: 890 },
                { id: 20, name: '開心果', category: 'nuts', price: 169, image: 'https://via.placeholder.com/300x300/90EE90/000000?text=開心果', description: '美國進口', stock: 40, rating: 4.7, sales: 760 },
                
                // 果乾類
                { id: 21, name: '蔓越莓乾', category: 'dried-fruit', price: 119, image: 'https://via.placeholder.com/300x300/DC143C/FFFFFF?text=蔓越莓乾', description: '天然無添加', stock: 65, rating: 4.5, sales: 1050 },
                { id: 22, name: '芒果乾', category: 'dried-fruit', price: 129, image: 'https://via.placeholder.com/300x300/FFA500/000000?text=芒果乾', description: '香甜多汁', stock: 58, rating: 4.6, sales: 920 },
                { id: 23, name: '葡萄乾', category: 'dried-fruit', price: 89, image: 'https://via.placeholder.com/300x300/800080/FFFFFF?text=葡萄乾', description: '新疆特產', stock: 72, rating: 4.4, sales: 1180 },
                { id: 24, name: '無花果乾', category: 'dried-fruit', price: 139, image: 'https://via.placeholder.com/300x300/D2B48C/000000?text=無花果乾', description: '土耳其進口', stock: 44, rating: 4.7, sales: 650 }
            ],
            
            // 分類
            categories: [
                { id: 'all', name: '全部商品', icon: 'fa-box' },
                { id: 'cookies', name: '餅乾', icon: 'fa-cookie-bite' },
                { id: 'chips', name: '洋芋片', icon: 'fa-bacon' },
                { id: 'candy', name: '糖果', icon: 'fa-candy-cane' },
                { id: 'chocolate', name: '巧克力', icon: 'fa-heart' },
                { id: 'nuts', name: '堅果', icon: 'fa-seedling' },
                { id: 'dried-fruit', name: '果乾', icon: 'fa-apple-alt' }
            ],
            
            // 優惠活動
            promotions: [
                { id: 1, title: '新年大促銷', description: '全館滿千折百', discount: 100, minPurchase: 1000, endDate: '2024-02-29', image: 'https://via.placeholder.com/800x300/FF6B6B/FFFFFF?text=新年大促銷' },
                { id: 2, title: '會員日', description: '會員專屬85折', discount: 15, type: 'percentage', endDate: '2024-01-31', image: 'https://via.placeholder.com/800x300/4ECDC4/FFFFFF?text=會員日' },
                { id: 3, title: '免運活動', description: '滿500免運費', freeShipping: true, minPurchase: 500, endDate: '2024-12-31', image: 'https://via.placeholder.com/800x300/FFE66D/000000?text=免運活動' }
            ],
            
            // 獲取所有產品
            async getProducts(filters = {}) {
                await this.delay(300);
                let filtered = [...this.products];
                
                if (filters.category && filters.category !== 'all') {
                    filtered = filtered.filter(p => p.category === filters.category);
                }
                
                if (filters.search) {
                    const search = filters.search.toLowerCase();
                    filtered = filtered.filter(p => 
                        p.name.toLowerCase().includes(search) || 
                        p.description.toLowerCase().includes(search)
                    );
                }
                
                if (filters.sortBy) {
                    switch(filters.sortBy) {
                        case 'price-asc':
                            filtered.sort((a, b) => a.price - b.price);
                            break;
                        case 'price-desc':
                            filtered.sort((a, b) => b.price - a.price);
                            break;
                        case 'rating':
                            filtered.sort((a, b) => b.rating - a.rating);
                            break;
                        case 'sales':
                            filtered.sort((a, b) => b.sales - a.sales);
                            break;
                        default:
                            break;
                    }
                }
                
                return filtered;
            },
            
            // 獲取單一產品
            async getProduct(id) {
                await this.delay(200);
                return this.products.find(p => p.id === parseInt(id));
            },
            
            // 獲取分類
            async getCategories() {
                await this.delay(100);
                return this.categories;
            },
            
            // 獲取優惠活動
            async getPromotions() {
                await this.delay(200);
                return this.promotions;
            },
            
            // 用戶認證
            async login(email, password) {
                await this.delay(500);
                // 簡單的模擬登入
                if (email && password) {
                    const user = {
                        id: 1,
                        name: '王小明',
                        email: email,
                        phone: '0912-345-678',
                        joinDate: '2023-01-15',
                        points: 500
                    };
                    localStorage.setItem('user', JSON.stringify(user));
                    return { success: true, user };
                }
                return { success: false, message: '帳號或密碼錯誤' };
            },
            
            // 註冊
            async register(userData) {
                await this.delay(500);
                const user = {
                    id: Date.now(),
                    ...userData,
                    joinDate: new Date().toISOString().split('T')[0],
                    points: 0
                };
                localStorage.setItem('user', JSON.stringify(user));
                return { success: true, user };
            },
            
            // 獲取當前用戶
            getCurrentUser() {
                const userStr = localStorage.getItem('user');
                return userStr ? JSON.parse(userStr) : null;
            },
            
            // 登出
            logout() {
                localStorage.removeItem('user');
            },
            
            // 提交訂單
            async submitOrder(orderData) {
                await this.delay(800);
                const order = {
                    id: 'ORD' + Date.now(),
                    ...orderData,
                    date: new Date().toISOString(),
                    status: 'pending'
                };
                
                // 儲存訂單到 localStorage
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                orders.unshift(order);
                localStorage.setItem('orders', JSON.stringify(orders));
                
                return { success: true, order };
            },
            
            // 獲取用戶訂單
            async getOrders() {
                await this.delay(300);
                return JSON.parse(localStorage.getItem('orders') || '[]');
            },
            
            // 獲取訂單詳情
            async getOrder(id) {
                await this.delay(200);
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                return orders.find(o => o.id === id);
            }
        };
        
        // ==================== Context ====================
        const AppContext = createContext();
        
        const useApp = () => {
            const context = useContext(AppContext);
            if (!context) {
                throw new Error('useApp must be used within AppProvider');
            }
            return context;
        };
        
        // ==================== App Provider ====================
        const AppProvider = ({ children }) => {
            const [currentPage, setCurrentPage] = useState('home');
            const [cart, setCart] = useState(() => {
                const saved = localStorage.getItem('cart');
                return saved ? JSON.parse(saved) : [];
            });
            const [favorites, setFavorites] = useState(() => {
                const saved = localStorage.getItem('favorites');
                return saved ? JSON.parse(saved) : [];
            });
            const [user, setUser] = useState(DataService.getCurrentUser());
            const [toast, setToast] = useState(null);
            const [pageData, setPageData] = useState({});
            
            // 儲存購物車到 localStorage
            useEffect(() => {
                localStorage.setItem('cart', JSON.stringify(cart));
            }, [cart]);
            
            // 儲存收藏到 localStorage
            useEffect(() => {
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }, [favorites]);
            
            // 導航到頁面
            const navigate = (page, data = {}) => {
                setCurrentPage(page);
                setPageData(data);
                window.scrollTo(0, 0);
            };
            
            // 添加到購物車
            const addToCart = (product, quantity = 1) => {
                setCart(prev => {
                    const existing = prev.find(item => item.id === product.id);
                    if (existing) {
                        return prev.map(item => 
                            item.id === product.id 
                                ? { ...item, quantity: item.quantity + quantity }
                                : item
                        );
                    }
                    return [...prev, { ...product, quantity }];
                });
                showToast('已加入購物車', 'success');
            };
            
            // 從購物車移除
            const removeFromCart = (productId) => {
                setCart(prev => prev.filter(item => item.id !== productId));
                showToast('已從購物車移除', 'info');
            };
            
            // 更新購物車數量
            const updateCartQuantity = (productId, quantity) => {
                if (quantity <= 0) {
                    removeFromCart(productId);
                    return;
                }
                setCart(prev => prev.map(item => 
                    item.id === productId ? { ...item, quantity } : item
                ));
            };
            
            // 清空購物車
            const clearCart = () => {
                setCart([]);
            };
            
            // 添加到收藏
            const toggleFavorite = (product) => {
                setFavorites(prev => {
                    const isFavorited = prev.some(item => item.id === product.id);
                    if (isFavorited) {
                        showToast('已從收藏移除', 'info');
                        return prev.filter(item => item.id !== product.id);
                    }
                    showToast('已加入收藏', 'success');
                    return [...prev, product];
                });
            };
            
            // 檢查是否已收藏
            const isFavorited = (productId) => {
                return favorites.some(item => item.id === productId);
            };
            
            // 登入
            const login = async (email, password) => {
                const result = await DataService.login(email, password);
                if (result.success) {
                    setUser(result.user);
                    showToast('登入成功', 'success');
                }
                return result;
            };
            
            // 註冊
            const register = async (userData) => {
                const result = await DataService.register(userData);
                if (result.success) {
                    setUser(result.user);
                    showToast('註冊成功', 'success');
                }
                return result;
            };
            
            // 登出
            const logout = () => {
                DataService.logout();
                setUser(null);
                showToast('已登出', 'info');
                navigate('home');
            };
            
            // 顯示提示
            const showToast = (message, type = 'info') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };
            
            // 計算購物車總計
            const cartTotal = useMemo(() => {
                return cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            }, [cart]);
            
            const value = {
                currentPage,
                navigate,
                cart,
                addToCart,
                removeFromCart,
                updateCartQuantity,
                clearCart,
                cartTotal,
                favorites,
                toggleFavorite,
                isFavorited,
                user,
                login,
                register,
                logout,
                toast,
                showToast,
                pageData
            };
            
            return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
        };
        
        // ==================== Components ====================
        
        // Toast 通知
        const Toast = ({ message, type }) => {
            const bgColors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle',
                warning: 'fa-exclamation-triangle'
            };
            
            return (
                <div className={`toast ${bgColors[type]} text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-3`}>
                    <i className={`fas ${icons[type]}`}></i>
                    <span>{message}</span>
                </div>
            );
        };
        
        // Loading 組件
        const Loading = () => (
            <div className="flex justify-center items-center py-20">
                <div className="spinner"></div>
            </div>
        );
        
        // Chatbot 組件
        const Chatbot = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { id: 1, text: '您好！我是零食天堂的客服小助手，有什麼可以幫助您的嗎？', sender: 'bot' }
            ]);
            const [inputValue, setInputValue] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const messagesEndRef = useRef(null);
            
            const quickReplies = [
                '產品推薦',
                '運費說明',
                '優惠活動',
                '退換貨政策',
                '聯絡客服'
            ];
            
            // 自動滾動到最新消息
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages, isTyping]);
            
            // 機器人回應邏輯
            const getBotResponse = (userMessage) => {
                const message = userMessage.toLowerCase();
                
                if (message.includes('推薦') || message.includes('產品')) {
                    return '我們有各種美味的零食！餅乾、洋芋片、糖果、巧克力、堅果和果乾等。您可以瀏覽「所有商品」頁面，或告訴我您喜歡的口味，我可以為您推薦！';
                } else if (message.includes('運費') || message.includes('運送')) {
                    return '目前我們提供滿500元免運費優惠，未滿500元則收取60元運費。商品通常在24小時內出貨，3-5個工作天送達。';
                } else if (message.includes('優惠') || message.includes('折扣') || message.includes('活動')) {
                    return '我們目前有新年大促銷（滿千折百）、會員專屬85折和滿500免運費活動！詳細資訊請查看「優惠活動」頁面。';
                } else if (message.includes('退換') || message.includes('退貨')) {
                    return '我們提供7天鑑賞期，商品如有問題可申請退換貨。請保留原始包裝和發票，並聯繫客服處理。詳情請見「退換貨政策」。';
                } else if (message.includes('客服') || message.includes('聯繫') || message.includes('電話')) {
                    return '客服專線：0800-123-456（週一至週日 09:00-21:00）\nEmail：service@snackheaven.com\n我們會盡快為您服務！';
                } else if (message.includes('謝謝') || message.includes('感謝')) {
                    return '不客氣！很高興能幫助您。如有其他問題，隨時告訴我！';
                } else {
                    return '抱歉，我不太理解您的問題。您可以詢問關於產品推薦、運費、優惠活動、退換貨政策或聯絡客服等問題。';
                }
            };
            
            const handleSendMessage = () => {
                if (!inputValue.trim()) return;
                
                // 添加用戶消息
                const userMessage = {
                    id: Date.now(),
                    text: inputValue,
                    sender: 'user'
                };
                
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsTyping(true);
                
                // 模擬機器人思考時間
                setTimeout(() => {
                    const botResponse = {
                        id: Date.now() + 1,
                        text: getBotResponse(inputValue),
                        sender: 'bot'
                    };
                    
                    setMessages(prev => [...prev, botResponse]);
                    setIsTyping(false);
                }, 1500);
            };
            
            const handleQuickReply = (reply) => {
                const userMessage = {
                    id: Date.now(),
                    text: reply,
                    sender: 'user'
                };
                
                setMessages(prev => [...prev, userMessage]);
                setIsTyping(true);
                
                // 模擬機器人思考時間
                setTimeout(() => {
                    const botResponse = {
                        id: Date.now() + 1,
                        text: getBotResponse(reply),
                        sender: 'bot'
                    };
                    
                    setMessages(prev => [...prev, botResponse]);
                    setIsTyping(false);
                }, 1500);
            };
            
            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleSendMessage();
                }
            };
            
            return (
                <div className="chatbot-container">
                    {isOpen && (
                        <div className={`chatbot-window ${isOpen ? 'open' : ''}`}>
                            <div className="chatbot-header">
                                <div className="flex items-center">
                                    <div className="w-8 h-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-2">
                                        <i className="fas fa-robot text-white"></i>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold">零食小助手</h3>
                                        <p className="text-xs opacity-80">線上為您服務</p>
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setIsOpen(false)}
                                    className="text-white hover:bg-white hover:bg-opacity-20 w-8 h-8 rounded-full flex items-center justify-center"
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div className="chatbot-messages">
                                {messages.map(message => (
                                    <div key={message.id} className={`message ${message.sender}`}>
                                        {message.text}
                                    </div>
                                ))}
                                {isTyping && (
                                    <div className="typing-indicator">
                                        <div className="typing-dot"></div>
                                        <div className="typing-dot"></div>
                                        <div className="typing-dot"></div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>
                            
                            <div className="quick-replies">
                                {quickReplies.map((reply, index) => (
                                    <div 
                                        key={index}
                                        className="quick-reply"
                                        onClick={() => handleQuickReply(reply)}
                                    >
                                        {reply}
                                    </div>
                                ))}
                            </div>
                            
                            <div className="chatbot-input">
                                <input 
                                    type="text"
                                    value={inputValue}
                                    onChange={(e) => setInputValue(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    placeholder="輸入您的問題..."
                                />
                                <button onClick={handleSendMessage}>
                                    <i className="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    )}
                    
                    <div 
                        className="chatbot-toggle"
                        onClick={() => setIsOpen(!isOpen)}
                    >
                        <i className={`fas ${isOpen ? 'fa-times' : 'fa-comments'}`}></i>
                    </div>
                </div>
            );
        };
        
        // Header 組件
        const Header = () => {
            const { navigate, cart, user, logout } = useApp();
            const [showMenu, setShowMenu] = useState(false);
            
            const cartItemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            return (
                <header className="bg-white shadow-md sticky top-0 z-50">
                    <div className="container mx-auto px-4">
                        <div className="flex items-center justify-between py-4">
                            {/* Logo */}
                            <div 
                                className="flex items-center space-x-2 cursor-pointer"
                                onClick={() => navigate('home')}
                            >
                                <i className="fas fa-cookie-bite text-3xl text-primary"></i>
                                <span className="text-2xl font-bold text-primary">零食天堂</span>
                            </div>
                            
                            {/* Desktop Navigation */}
                            <nav className="hidden md:flex items-center space-x-6">
                                <a onClick={() => navigate('home')} className="text-gray-700 hover:text-primary cursor-pointer transition">首頁</a>
                                <a onClick={() => navigate('products')} className="text-gray-700 hover:text-primary cursor-pointer transition">所有商品</a>
                                <a onClick={() => navigate('promotions')} className="text-gray-700 hover:text-primary cursor-pointer transition">優惠活動</a>
                                <a onClick={() => navigate('about')} className="text-gray-700 hover:text-primary cursor-pointer transition">關於我們</a>
                                <a onClick={() => navigate('contact')} className="text-gray-700 hover:text-primary cursor-pointer transition">聯絡我們</a>
                            </nav>
                            
                            {/* Icons */}
                            <div className="flex items-center space-x-4">
                                <button 
                                    onClick={() => navigate('search')}
                                    className="text-gray-700 hover:text-primary transition"
                                >
                                    <i className="fas fa-search text-xl"></i>
                                </button>
                                
                                <button 
                                    onClick={() => navigate('favorites')}
                                    className="text-gray-700 hover:text-primary transition relative"
                                >
                                    <i className="fas fa-heart text-xl"></i>
                                </button>
                                
                                <button 
                                    onClick={() => navigate('cart')}
                                    className="text-gray-700 hover:text-primary transition relative"
                                >
                                    <i className="fas fa-shopping-cart text-xl"></i>
                                    {cartItemCount > 0 && (
                                        <span className="absolute -top-2 -right-2 bg-secondary text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            {cartItemCount}
                                        </span>
                                    )}
                                </button>
                                
                                {user ? (
                                    <div className="relative group">
                                        <button className="text-gray-700 hover:text-primary transition">
                                            <i className="fas fa-user text-xl"></i>
                                        </button>
                                        <div className="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 hidden group-hover:block">
                                            <a onClick={() => navigate('profile')} className="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">會員中心</a>
                                            <a onClick={() => navigate('orders')} className="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">訂單查詢</a>
                                            <a onClick={logout} className="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">登出</a>
                                        </div>
                                    </div>
                                ) : (
                                    <button 
                                        onClick={() => navigate('login')}
                                        className="text-gray-700 hover:text-primary transition"
                                    >
                                        <i className="fas fa-user text-xl"></i>
                                    </button>
                                )}
                                
                                {/* Mobile Menu Toggle */}
                                <button 
                                    className="md:hidden text-gray-700"
                                    onClick={() => setShowMenu(!showMenu)}
                                >
                                    <i className={`fas ${showMenu ? 'fa-times' : 'fa-bars'} text-xl`}></i>
                                </button>
                            </div>
                        </div>
                        
                        {/* Mobile Navigation */}
                        {showMenu && (
                            <nav className="md:hidden py-4 border-t animate-slide-in">
                                <a onClick={() => { navigate('home'); setShowMenu(false); }} className="block py-2 text-gray-700 hover:text-primary cursor-pointer">首頁</a>
                                <a onClick={() => { navigate('products'); setShowMenu(false); }} className="block py-2 text-gray-700 hover:text-primary cursor-pointer">所有商品</a>
                                <a onClick={() => { navigate('promotions'); setShowMenu(false); }} className="block py-2 text-gray-700 hover:text-primary cursor-pointer">優惠活動</a>
                                <a onClick={() => { navigate('about'); setShowMenu(false); }} className="block py-2 text-gray-700 hover:text-primary cursor-pointer">關於我們</a>
                                <a onClick={() => { navigate('contact'); setShowMenu(false); }} className="block py-2 text-gray-700 hover:text-primary cursor-pointer">聯絡我們</a>
                            </nav>
                        )}
                    </div>
                </header>
            );
        };
        
        // Footer 組件
        const Footer = () => {
            const { navigate } = useApp();
            
            return (
                <footer className="bg-gray-900 text-white mt-20">
                    <div className="container mx-auto px-4 py-12">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                            <div>
                                <h3 className="text-xl font-bold mb-4 flex items-center">
                                    <i className="fas fa-cookie-bite mr-2"></i>
                                    零食天堂
                                </h3>
                                <p className="text-gray-400">
                                    提供最優質的零食，讓您的生活更甜蜜
                                </p>
                            </div>
                            
                            <div>
                                <h4 className="text-lg font-semibold mb-4">快速連結</h4>
                                <ul className="space-y-2">
                                    <li><a onClick={() => navigate('about')} className="text-gray-400 hover:text-white cursor-pointer transition">關於我們</a></li>
                                    <li><a onClick={() => navigate('products')} className="text-gray-400 hover:text-white cursor-pointer transition">所有商品</a></li>
                                    <li><a onClick={() => navigate('promotions')} className="text-gray-400 hover:text-white cursor-pointer transition">優惠活動</a></li>
                                    <li><a onClick={() => navigate('faq')} className="text-gray-400 hover:text-white cursor-pointer transition">常見問題</a></li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 className="text-lg font-semibold mb-4">客戶服務</h4>
                                <ul className="space-y-2">
                                    <li><a onClick={() => navigate('contact')} className="text-gray-400 hover:text-white cursor-pointer transition">聯絡我們</a></li>
                                    <li><a onClick={() => navigate('orders')} className="text-gray-400 hover:text-white cursor-pointer transition">訂單查詢</a></li>
                                    <li><a className="text-gray-400 hover:text-white cursor-pointer transition">退換貨政策</a></li>
                                    <li><a className="text-gray-400 hover:text-white cursor-pointer transition">隱私權政策</a></li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 className="text-lg font-semibold mb-4">聯絡資訊</h4>
                                <ul className="space-y-2 text-gray-400">
                                    <li><i className="fas fa-phone mr-2"></i> 0800-123-456</li>
                                    <li><i className="fas fa-envelope mr-2"></i> service@snackheaven.com</li>
                                    <li><i className="fas fa-map-marker-alt mr-2"></i> 台北市信義區信義路五段7號</li>
                                </ul>
                                <div className="flex space-x-4 mt-4">
                                    <a href="#" className="text-gray-400 hover:text-white transition"><i className="fab fa-facebook text-2xl"></i></a>
                                    <a href="#" className="text-gray-400 hover:text-white transition"><i className="fab fa-instagram text-2xl"></i></a>
                                    <a href="#" className="text-gray-400 hover:text-white transition"><i className="fab fa-line text-2xl"></i></a>
                                </div>
                            </div>
                        </div>
                        
                        <div className="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                            <p>&copy; 2024 零食天堂. All rights reserved.</p>
                        </div>
                    </div>
                </footer>
            );
        };
        
        // 產品卡片組件
        const ProductCard = ({ product }) => {
            const { navigate, addToCart, toggleFavorite, isFavorited } = useApp();
            const favorited = isFavorited(product.id);
            
            return (
                <div className="product-card bg-white rounded-lg shadow-md overflow-hidden">
                    <div className="relative">
                        <img 
                            src={product.image} 
                            alt={product.name}
                            className="w-full h-48 object-cover cursor-pointer"
                            onClick={() => navigate('product-detail', { productId: product.id })}
                        />
                        <button 
                            onClick={() => toggleFavorite(product)}
                            className="absolute top-2 right-2 bg-white rounded-full w-10 h-10 flex items-center justify-center shadow-md hover:scale-110 transition"
                        >
                            <i className={`fas fa-heart ${favorited ? 'text-secondary' : 'text-gray-400'}`}></i>
                        </button>
                        {product.stock < 10 && (
                            <span className="absolute top-2 left-2 bg-secondary text-white px-2 py-1 rounded text-xs">
                                剩餘 {product.stock} 件
                            </span>
                        )}
                    </div>
                    
                    <div className="p-4">
                        <h3 
                            className="text-lg font-semibold mb-2 cursor-pointer hover:text-primary transition"
                            onClick={() => navigate('product-detail', { productId: product.id })}
                        >
                            {product.name}
                        </h3>
                        <p className="text-gray-600 text-sm mb-3">{product.description}</p>
                        
                        <div className="flex items-center mb-3">
                            <div className="flex text-warning">
                                {[...Array(5)].map((_, i) => (
                                    <i key={i} className={`fas fa-star ${i < Math.floor(product.rating) ? '' : 'text-gray-300'}`}></i>
                                ))}
                            </div>
                            <span className="text-gray-600 text-sm ml-2">({product.rating})</span>
                        </div>
                        
                        <div className="flex items-center justify-between">
                            <span className="text-2xl font-bold text-primary">NT$ {product.price}</span>
                            <button 
                                onClick={() => addToCart(product)}
                                className="btn-primary bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90"
                            >
                                <i className="fas fa-cart-plus mr-2"></i>
                                加入購物車
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // ==================== Pages ====================
        
        // 首頁
        const HomePage = () => {
            const { navigate } = useApp();
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                loadData();
            }, []);
            
            const loadData = async () => {
                setLoading(true);
                const [productsData, categoriesData] = await Promise.all([
                    DataService.getProducts({ sortBy: 'sales' }),
                    DataService.getCategories()
                ]);
                setProducts(productsData.slice(0, 8));
                setCategories(categoriesData);
                setLoading(false);
            };
            
            return (
                <div className="animate-fade-in">
                    {/* Hero Section */}
                    <section className="bg-gradient-to-r from-primary to-purple-600 text-white py-20">
                        <div className="container mx-auto px-4 text-center">
                            <h1 className="text-4xl md:text-6xl font-bold mb-4">歡迎來到零食天堂</h1>
                            <p className="text-xl md:text-2xl mb-8">精選優質零食，滿足您的味蕾</p>
                            <button 
                                onClick={() => navigate('products')}
                                className="btn-primary bg-white text-primary px-8 py-3 rounded-full text-lg font-semibold hover:shadow-lg"
                            >
                                立即選購
                            </button>
                        </div>
                    </section>
                    
                    {/* Categories */}
                    <section className="container mx-auto px-4 py-16">
                        <h2 className="text-3xl font-bold text-center mb-10">商品分類</h2>
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                            {categories.filter(c => c.id !== 'all').map(category => (
                                <div 
                                    key={category.id}
                                    onClick={() => navigate('category', { category: category.id })}
                                    className="bg-white rounded-lg shadow-md p-6 text-center cursor-pointer hover:shadow-lg transition transform hover:-translate-y-1"
                                >
                                    <i className={`fas ${category.icon} text-4xl text-primary mb-3`}></i>
                                    <h3 className="font-semibold">{category.name}</h3>
                                </div>
                            ))}
                        </div>
                    </section>
                    
                    {/* Hot Products */}
                    <section className="container mx-auto px-4 py-16 bg-gray-50">
                        <div className="flex items-center justify-between mb-10">
                            <h2 className="text-3xl font-bold">熱銷商品</h2>
                            <button 
                                onClick={() => navigate('products')}
                                className="text-primary hover:underline"
                            >
                                查看更多 <i className="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                        
                        {loading ? (
                            <Loading />
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                {products.map(product => (
                                    <ProductCard key={product.id} product={product} />
                                ))}
                            </div>
                        )}
                    </section>
                    
                    {/* Features */}
                    <section className="container mx-auto px-4 py-16">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div className="text-center">
                                <div className="bg-primary bg-opacity-10 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                    <i className="fas fa-shipping-fast text-3xl text-primary"></i>
                                </div>
                                <h3 className="text-xl font-semibold mb-2">快速配送</h3>
                                <p className="text-gray-600">24小時內快速出貨</p>
                            </div>
                            
                            <div className="text-center">
                                <div className="bg-primary bg-opacity-10 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                    <i className="fas fa-shield-alt text-3xl text-primary"></i>
                                </div>
                                <h3 className="text-xl font-semibold mb-2">品質保證</h3>
                                <p className="text-gray-600">嚴選優質商品</p>
                            </div>
                            
                            <div className="text-center">
                                <div className="bg-primary bg-opacity-10 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                    <i className="fas fa-headset text-3xl text-primary"></i>
                                </div>
                                <h3 className="text-xl font-semibold mb-2">貼心客服</h3>
                                <p className="text-gray-600">專業團隊隨時服務</p>
                            </div>
                        </div>
                    </section>
                </div>
            );
        };
        
        // 所有商品頁
        const ProductsPage = () => {
            const [products, setProducts] = useState([]);
            const [categories, setCategories] = useState([]);
            const [loading, setLoading] = useState(true);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [sortBy, setSortBy] = useState('');
            
            useEffect(() => {
                loadData();
            }, []);
            
            useEffect(() => {
                filterProducts();
            }, [selectedCategory, sortBy]);
            
            const loadData = async () => {
                const [productsData, categoriesData] = await Promise.all([
                    DataService.getProducts(),
                    DataService.getCategories()
                ]);
                setProducts(productsData);
                setCategories(categoriesData);
                setLoading(false);
            };
            
            const filterProducts = async () => {
                setLoading(true);
                const filtered = await DataService.getProducts({
                    category: selectedCategory,
                    sortBy: sortBy
                });
                setProducts(filtered);
                setLoading(false);
            };
            
            return (
                <div className="container mx-auto px-4 py-8 animate-fade-in">
                    <h1 className="text-3xl font-bold mb-8">所有商品</h1>
                    
                    <div className="flex flex-col md:flex-row gap-8">
                        {/* Filters Sidebar */}
                        <div className="md:w-64">
                            <div className="bg-white rounded-lg shadow-md p-6 sticky top-24">
                                <h3 className="font-semibold text-lg mb-4">商品分類</h3>
                                <div className="space-y-2">
                                    {categories.map(category => (
                                        <button
                                            key={category.id}
                                            onClick={() => setSelectedCategory(category.id)}
                                            className={`w-full text-left px-4 py-2 rounded-lg transition ${
                                                selectedCategory === category.id 
                                                    ? 'bg-primary text-white' 
                                                    : 'hover:bg-gray-100'
                                            }`}
                                        >
                                            <i className={`fas ${category.icon} mr-2`}></i>
                                            {category.name}
                                        </button>
                                    ))}
                                </div>
                                
                                <h3 className="font-semibold text-lg mb-4 mt-8">排序方式</h3>
                                <select 
                                    value={sortBy}
                                    onChange={(e) => setSortBy(e.target.value)}
                                    className="w-full px-4 py-2 border rounded-lg text-base"
                                >
                                    <option value="">預設排序</option>
                                    <option value="price-asc">價格：低到高</option>
                                    <option value="price-desc">價格：高到低</option>
                                    <option value="rating">評分最高</option>
                                    <option value="sales">最熱銷</option>
                                </select>
                            </div>
                        </div>
                        
                        {/* Products Grid */}
                        <div className="flex-1">
                            {loading ? (
                                <Loading />
                            ) : products.length === 0 ? (
                                <div className="text-center py-20">
                                    <i className="fas fa-box-open text-6xl text-gray-300 mb-4"></i>
                                    <p className="text-gray-500">沒有找到商品</p>
                                </div>
                            ) : (
                                <>
                                    <div className="mb-4 text-gray-600">
                                        找到 {products.length} 件商品
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {products.map(product => (
                                            <ProductCard key={product.id} product={product} />
                                        ))}
                                    </div>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };
        
        // 主應用組件
        const App = () => {
            const { currentPage, toast, navigate } = useApp();
            
            const renderPage = () => {
                switch (currentPage) {
                    case 'home':
                        return <HomePage />;
                    case 'products':
                        return <ProductsPage />;
                    // 其他頁面組件...
                    default:
                        return <HomePage />;
                }
            };
            
            return (
                <div className="min-h-screen bg-gray-50">
                    <Header />
                    <main>
                        {renderPage()}
                    </main>
                    <Footer />
                    {toast && <Toast message={toast.message} type={toast.type} />}
                    <Chatbot />
                </div>
            );
        };
        
        // 渲染應用
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <AppProvider>
                <App />
            </AppProvider>
        );
    </script>
</body>
</html>